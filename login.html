<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>CG Auto Sales • Login</title>
  <style>
    :root{
      --bg:#0b0d12; --card:#111522; --text:#e9eef7; --muted:#aab3c5;
      --line:rgba(255,255,255,.10);
      --blue:#3b82f6; --orange:#f59e0b;
      --shadow: 0 12px 40px rgba(0,0,0,.45);
      --r:18px; --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:var(--font); color:var(--text);
      background: radial-gradient(900px 650px at 20% -10%, rgba(59,130,246,.25), transparent 60%),
                  radial-gradient(800px 600px at 90% 10%, rgba(245,158,11,.18), transparent 55%),
                  var(--bg);
      min-height:100vh; display:flex; align-items:center; justify-content:center; padding:18px;
    }
    .box{
      width:min(920px, 100%);
      display:grid; grid-template-columns: 1.1fr .9fr; gap:14px;
    }
    .panel{
      border:1px solid var(--line); border-radius: 22px;
      background: rgba(255,255,255,.03); box-shadow: var(--shadow);
      overflow:hidden;
    }
    .left{padding:18px}
    .brand{display:flex; gap:12px; align-items:center}
    .logo{width:44px;height:44px;border-radius:16px;
      background: linear-gradient(135deg, rgba(59,130,246,.95), rgba(245,158,11,.75));
      box-shadow: 0 10px 28px rgba(0,0,0,.35);
    }
    h1{margin:0;font-size:18px}
    p{margin:8px 0 0; color:var(--muted); font-size:13px; line-height:1.4}
    .bullets{margin-top:14px; display:grid; gap:10px; color:var(--muted); font-size:13px}
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 10px; border-radius: 999px;
      border:1px solid var(--line); background: rgba(255,255,255,.02);
      width: fit-content;
    }
    .dot{width:7px;height:7px;border-radius:999px;background:rgba(59,130,246,.85)}
    .dot.orange{background:rgba(245,158,11,.95)}
    .right{padding:18px}
    .tabs{display:flex; gap:10px; margin-bottom:12px}
    .tab{
      flex:1;
      border:1px solid var(--line);
      background: rgba(255,255,255,.02);
      border-radius: 14px;
      padding:10px 12px;
      font-weight:800;
      cursor:pointer;
      text-align:center;
      user-select:none;
    }
    .tab.active{
      border-color: rgba(59,130,246,.45);
      background: rgba(59,130,246,.12);
    }
    .field{display:flex; flex-direction:column; gap:6px; margin-top:10px}
    label{font-size:12px; color:var(--muted)}
    input{
      width:100%;
      border:1px solid var(--line);
      background: rgba(255,255,255,.03);
      color:var(--text);
      padding:11px 12px;
      border-radius: 14px;
      outline:none;
    }
    input:focus{
      border-color: rgba(59,130,246,.55);
      box-shadow: 0 0 0 3px rgba(59,130,246,.15);
    }
    .row{display:flex; gap:10px; margin-top:14px; flex-wrap:wrap}
    .btn{
      border:1px solid var(--line);
      background: rgba(255,255,255,.03);
      color:var(--text);
      padding:11px 12px;
      border-radius:14px;
      font-weight:900;
      cursor:pointer;
      flex:1;
      min-width: 170px;
    }
    .btn.blue{border-color: rgba(59,130,246,.45); background: rgba(59,130,246,.12);}
    .btn.orange{border-color: rgba(245,158,11,.45); background: rgba(245,158,11,.12);}
    .msg{margin-top:12px; font-size:13px; color:var(--muted)}
    .err{color:#fecaca}
    .ok{color:#bbf7d0}
    a{color:inherit}
    .small{font-size:12px}
    @media (max-width:900px){ .box{grid-template-columns: 1fr} }
  </style>
</head>
<body>
  <div class="box">
    <div class="panel left">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>CG Auto Sales</h1>
          <p>Log in to upload listings and chat with sellers.</p>
        </div>
      </div>

      <div class="bullets">
        <div class="pill"><span class="dot"></span> Upload listings (logged-in only)</div>
        <div class="pill"><span class="dot"></span> Chat with sellers (logged-in only)</div>
        <div class="pill"><span class="dot orange"></span> Featured Section promos (paid)</div>
        <div class="pill"><span class="dot orange"></span> Photo + Promo package (we come shoot it)</div>
        <p class="small">After you log in, you’ll be redirected back to what you tried to open.</p>
      </div>
    </div>

    <div class="panel right">
      <div class="tabs">
        <div class="tab active" id="loginTab">Log in</div>
        <div class="tab" id="signupTab">Sign up</div>
      </div>

      <div class="field">
        <label for="email">Email</label>
        <input id="email" type="email" placeholder="you@email.com" autocomplete="email"/>
      </div>

      <div class="field">
        <label for="password">Password</label>
        <input id="password" type="password" placeholder="••••••••" autocomplete="current-password"/>
      </div>

      <div class="row">
        <button class="btn blue" id="primaryBtn">Log in</button>
        <button class="btn" id="backBtn">Back</button>
      </div>

      <div class="msg" id="msg"></div>
    </div>
  </div>

  <script type="module">
    import { auth } from "./js/firebase.js";
    import {
      onAuthStateChanged,
      signInWithEmailAndPassword,
      createUserWithEmailAndPassword,
      signOut
    } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-auth.js";

    const loginTab = document.getElementById("loginTab");
    const signupTab = document.getElementById("signupTab");
    const primaryBtn = document.getElementById("primaryBtn");
    const backBtn = document.getElementById("backBtn");
    const msg = document.getElementById("msg");

    const email = document.getElementById("email");
    const password = document.getElementById("password");

    const params = new URLSearchParams(location.search);
    const next = params.get("next") ? decodeURIComponent(params.get("next")) : "./index.html";

    let mode = "login"; // "login" or "signup"

    function setMode(m){
      mode = m;
      loginTab.classList.toggle("active", mode==="login");
      signupTab.classList.toggle("active", mode==="signup");
      primaryBtn.textContent = mode==="login" ? "Log in" : "Create account";
      msg.textContent = "";
      msg.className = "msg";
      password.autocomplete = mode==="login" ? "current-password" : "new-password";
    }

    loginTab.addEventListener("click", ()=> setMode("login"));
    signupTab.addEventListener("click", ()=> setMode("signup"));

    backBtn.addEventListener("click", ()=>{
      location.href = next;
    });

    function show(text, kind){
      msg.textContent = text;
      msg.className = "msg " + (kind || "");
    }

    function friendlyError(e){
      const code = e?.code || "";
      if(code.includes("auth/invalid-email")) return "That email address doesn’t look valid.";
      if(code.includes("auth/user-not-found")) return "No account found for that email.";
      if(code.includes("auth/wrong-password")) return "Wrong password.";
      if(code.includes("auth/email-already-in-use")) return "That email is already in use. Try logging in.";
      if(code.includes("auth/weak-password")) return "Password is too weak (try 6+ characters).";
      if(code.includes("auth/operation-not-allowed")) return "Email/password sign-in is disabled in Firebase Auth settings.";
      return e?.message || "Something went wrong.";
    }

    primaryBtn.addEventListener("click", async ()=>{
      primaryBtn.disabled = true;
      show("Working…");

      try{
        if(mode === "login"){
          await signInWithEmailAndPassword(auth, email.value.trim(), password.value);
          show("Logged in. Redirecting…", "ok");
          location.href = next;
        } else {
          await createUserWithEmailAndPassword(auth, email.value.trim(), password.value);
          show("Account created. Redirecting…", "ok");
          location.href = next;
        }
      } catch(e){
        show(friendlyError(e), "err");
      } finally {
        primaryBtn.disabled = false;
      }
    });

    // If they’re already logged in, bounce them back.
    onAuthStateChanged(auth, (user)=>{
      if(user){
        show("You’re already logged in. Redirecting…", "ok");
        setTimeout(()=> location.href = next, 600);
      }
    });

    // default
    setMode("login");
  </script>
</body>
</html>
